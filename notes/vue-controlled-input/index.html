<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Vue Controlled Input - using v-model and watch - suXin space</title>
    <meta name="og:title" content="Vue Controlled Input - using v-model and watch - suXin space"/>
    <meta name="og:description" content="Lampshading the way to make an input actually controlled while keeping it simple with v-model and watch."/>
    <meta name="og:url" content="https://suxin.space/notes/vue-controlled-input"/>
    <meta name="og:image" content="https://suxin.space/notes/vue-controlled-input/vue.png"/>
    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:title" content="Vue Controlled Input - using v-model and watch - suXin space"/>
    <meta name="twitter:description" content="Lampshading the way to make an input actually controlled while keeping it simple with v-model and watch."/>
    <meta name="twitter:site" content="@suxinjke"/>
    <meta name="twitter:image" content="https://suxin.space/notes/vue-controlled-input/vue.png"/>
    <link rel="stylesheet" href="/normalize.min.css">
    <link rel="stylesheet" href="/fonts/fonts.css">
    <link rel="stylesheet" href="/main.css?t=1710317189341">
    <link rel="stylesheet" href="/notes/note.css?t=1710317189341">
    <link rel="stylesheet" href="/prism-github.css?t=1710317189341">
    <script src="/main.js?t=1710317189341" defer=""></script>
    <script src="./react-example.js?t=1710317189341" defer=""></script>
    <script src="./vue-example.js?t=1710317189341" defer=""></script>
  </head>
  <body>
    <header class="header"><nav class="nav header__nav"><a href="/" class="nav__link"><div class="header-text"><div class="header-text__icon-container"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"/></svg></div><div class="header-text__content" title="Home"><h2 class="header-text__primary uppercase">Home</h2></div></div></a><a href="/notes/" class="nav__link active expand"><div class="header-text"><div class="header-text__icon-container"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path fill="currentColor" d="M224 136V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H248c-13.2 0-24-10.8-24-24zm160-14.1v6.1H256V0h6.1c6.4 0 12.5 2.5 17 7l97.9 98c4.5 4.5 7 10.6 7 16.9z"/></svg></div><div class="header-text__content" title="Notes - Vue Controlled Input - using v-model and watch"><h3 class="header-text__secondary">Vue Controlled Input - using v-model and watch</h3><h2 class="header-text__primary uppercase">Notes</h2></div></div></a></nav><h2 class="header__logo">suXin space</h2></header><main class="readable note short-width"><h1><strong>Vue Controlled Input - using v-model and watch</strong></h1><h3 class="uppercase">May 25 2019</h3><div class="note__content"><h2 id="what-i-want"><strong>What I want</strong><a href="#what-i-want" class="anchor-link"><span>¶</span></a></h2><div id="react-example">
</div>

<h3 id="vue"><strong>Vue</strong><a href="#vue" class="anchor-link"><span>¶</span></a></h3><pre class="language-js"><code class="language-js"><span class="token operator">&lt;</span>template<span class="token operator">></span>
    <span class="token operator">&lt;</span>div<span class="token operator">></span>
        <span class="token literal-property property">Value</span><span class="token operator">:</span> <span class="token operator">&lt;</span>input v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"value"</span><span class="token operator">/</span><span class="token operator">></span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span>

<span class="token operator">&lt;</span>script<span class="token operator">></span>
<span class="token keyword module">export</span> <span class="token keyword module">default</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">value</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span> <span class="token parameter">newValue</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            newValue <span class="token operator">=</span> newValue<span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token char-class"><span class="token char-class-punctuation punctuation">[</span><span class="token char-class-negation operator">^</span><span class="token char-set class-name">\d</span><span class="token char-class-punctuation punctuation">]</span></span></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span> newValue<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newValue <span class="token operator">=</span> newValue <span class="token operator">+</span> <span class="token string">'$'</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">value</span> <span class="token operator">=</span> newValue
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h3 id="compared-to-react"><strong>Compared to React</strong><a href="#compared-to-react" class="anchor-link"><span>¶</span></a></h3><pre class="language-js"><code class="language-js"><span class="token keyword">class</span> <span class="token class-name">ControlledInput</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onChange</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">onChange</span><span class="token punctuation">.</span><span class="token method function property-access">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">onChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> value <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token property-access">target</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token char-class"><span class="token char-class-punctuation punctuation">[</span><span class="token char-class-negation operator">^</span><span class="token char-set class-name">\d</span><span class="token char-class-punctuation punctuation">]</span></span></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword control-flow">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            value <span class="token operator">=</span> value <span class="token operator">+</span> <span class="token string">'$'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">value</span><span class="token operator">:</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span>
            <span class="token operator">&lt;</span>div<span class="token operator">></span>
                <span class="token literal-property property">Value</span><span class="token operator">:</span> <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">value</span><span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">onChange</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
            <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><h2 id="about-getting-there"><strong>About getting there</strong><a href="#about-getting-there" class="anchor-link"><span>¶</span></a></h2><p>At first I was very surprised to not find anything similar to this solution. Searching <strong>Vue controlled input</strong> only gave me <strong>one blog post</strong> and some <strong>StackOverflow answers</strong>, most of them not solving the problem in a way I want, going around it or being more complex than it should.</p>
<p>Some websites may have an input with very strict validation: be it telephone number, amount of money, or something else that implies an input mask. Formatting the input as you type it may ease checking whatever that&#39;s typed for user. It&#39;s much easier to read <strong>4093 8123 9332 8423 8495</strong> rather than <strong>40938123933284238495</strong>.</p>
<p>Unfortunately we don&#39;t have much options when it comes to formatting and styling text input like that. <strong>Whatever is inside the text input must be represented as the plain text string.</strong></p>
<p>Solving this problem with <strong>React</strong> seems trivial, because when you pass the state to the <strong>value</strong> attribute of the <strong>input</strong> - <strong>it&#39;s dead locked</strong>, that state is now single source of truth for this input and you&#39;re free to apply additional formatting to the value when it changes. It&#39;s still possible to set incorrect state but it would be coming from your <strong>React</strong> code, not user input.</p>
<p>I failed to follow similar approach in <strong>Vue</strong>. If instead of using <strong>v-model</strong> you go for similar binding of <strong>value</strong> and declaring <strong>@change</strong> event - it&#39;s not going to be as strict in <strong>React</strong>, in fact you can avoid handling value change part - it will remain out of sync just fine. Compared to <strong>React</strong>, <strong>@change</strong> also executes only after you&#39;re done with the input (blur/go out of focus), <em>which is actually how it&#39;s supposed to work</em>, something I didn&#39;t know about before.</p>
<p>You can use <strong>@input</strong> instead of <strong>@change</strong> to get similar behaviour, but sync problems remain.</p>
<p>Binding it to the <strong>computed value</strong> won&#39;t help either, you can still freely type in the input.</p>
<p>This made me wonder if the only way to do it would be by overriding events like <strong>onkeydown</strong> and preventing them if incorrect characters are entered, but you&#39;ll have to make sure to catch all other events like <strong>onpaste</strong>, this seems worse to maintain compared to <strong>React</strong> approach.</p>
<p>The last idea involved changing <strong>value</strong> attribute of the <strong>inputs</strong> directly via <strong>$ref</strong>, I can&#39;t even remember exactly what I did with these, but some of the solutions found on the internet follow this approach and it may be sufficient enough, but it&#39;s still a hacky solution.</p>
<p><strong>Here&#39;s what I found by searching for <em>Vue controlled input</em>:</strong></p>
<ul>
<li><a  href="https://bangjelkoski.com/blog/building-a-controlled-vue-input-component" target="_blank" rel="noopener"><strong>Building a controlled Vue input component</strong></a>: It&#39;s just about passing the value deep down your component chain via props and catching the changes in the parent, all of the issues specified are still there.</li>
<li><a  href="https://gist.github.com/Jokcy/0789228b25d73f6a017b0b04e01ae34a" target="_blank" rel="noopener"><strong>vue controlled input gist</strong></a>: this is an example of doing it with <strong>$ref</strong>. Not sure why <strong>onchange</strong> is handled here, the <strong>currentValue</strong> doesn&#39;t make sense to me because a <strong>value prop</strong> is applied via <strong>$ref</strong> directly. If I handle formatting on upper level - I&#39;m still able to type incorrect characters.</li>
<li><a  href="https://stackoverflow.com/questions/55195878/vue-controlled-inputs" target="_blank" rel="noopener"><strong>StackOverflow - Vue controlled inputs</strong></a>: tons of use <code>input=&quot;number&quot;</code> or specific keyboard events.</li>
<li><a  href="https://stackoverflow.com/questions/39782176/filter-input-text-only-accept-number-and-dot-vue-js" target="_blank" rel="noopener"><strong>StackOverflow - Filter input text only accept number and dot vue.js</strong></a>: once again a ton of keyboard event suggestions, there&#39;s <strong>Directive</strong> approach mentioned that some people still put keyboard events into, and hacking around <em>&quot;if you type more than one letter the second one sometimes goes through&quot;</em> would also be just as unpleasant.</li>
<li><a  href="https://stackoverflow.com/questions/43568635/writing-custom-form-controls-to-use-v-model-in-vue-js" target="_blank" rel="noopener"><strong>StackOverflow - Writing custom form controls to use v-model in Vue.js</strong></a>: hey, this actually hints at the <strong>watch</strong> approach similar to mine, <em>that I failed to notice until I started writing this note</em>.</li>
<li><a  href="https://www.npmjs.com/package/vue-controlled-input" target="_blank" rel="noopener"><strong>npm - vue-controlled-input</strong></a>: same as above - I decided only to look into this package with no GitHub repo only because I&#39;m writing this note, and surprisingly, <strong>it has exactly the same approach that I got</strong>.</li>
</ul>
<p>While two latter results are still on top of Google search, it takes effort or some desperation to notice the <strong>watch</strong> approach in making the input controllable. This is why I decided to write this note, to lampshade this simple way of doing it.</p>
<p><strong>I tried to search for something other than <em>controlled input</em> afterwards:</strong></p>
<ul>
<li><a  href="https://github.com/vuejs-tips/v-money" target="_blank" rel="noopener"><strong>v-money</strong></a>: does it exactly the way I would like, and <a  href="https://github.com/vuejs-tips/v-money/blob/8874322/src/component.vue#L59" target="_blank" rel="noopener">if you peek inside the code</a> - it&#39;s the same watch approach.</li>
<li><a  href="https://kevinongko.github.io/vue-numeric/" target="_blank" rel="noopener"><strong>vue-numeric</strong></a>: formatting only after you&#39;re done with the input is questionable, it&#39;s one of the approaches I also saw on <strong>StackOverflow</strong>. It may suit some people who type while looking at the keyboard - because they will see all typos which then should disappear, but I don&#39;t like that caret is always set at the end of the input when you focus and that edited value may be hard to read.</li>
<li><a  href="https://jsfiddle.net/mani04/bgzhw68m/" target="_blank" rel="noopener"><strong>JSFiddle - Formatted currency input component using Vue.js</strong></a>: similar approach to <strong>vue-numeric</strong>, implementation is complex, resolving around computed property with getter and setter.</li>
</ul>
<h2 id="another-bonus-example"><strong>Another bonus example</strong><a href="#another-bonus-example" class="anchor-link"><span>¶</span></a></h2><p>The example at the top is simplified and is only supposed to demonstrate the approach. <a  href="https://codesandbox.io/s/4qpzyp7pl9?file=/src/App.vue" target="_blank" rel="noopener">How about something more real, like adding spaces to the number to maintain readability?</a></p>
<div id="vue-example"></div>

<p>Here, <strong>$ref</strong> is still required to extract the input&#39;s caret position and calculate a new one, to ensure that you will have good experience without caret jumping around.</p>
<p>Please don&#39;t mind the code for adding spaces, I&#39;m sure there&#39;s a better way for that.</p>
<p>By the way, due to the nature of <strong>watch</strong>, even if you change the data by other means than input - it still will be formatted properly, and I like that.</p>
</div></main>
    
  </body>
</html>